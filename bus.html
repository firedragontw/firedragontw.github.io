<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Âè∞ÂåóÂÖ¨ËªäÊìÅÊì†Â∫¶‰∫íÂãïÊ®°Êì¨Á≥ªÁµ± - ‰øØË¶ñÂúñÁâà</title>
  <style>
    :root {
      --background: rgba(255, 255, 255, 0.4);
      --panel-bg: rgba(255, 255, 255, 0.6);
      --accent: #007aff;
      --text: #111;
      --subtext: #666;
      --border: rgba(200, 200, 200, 0.4);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      --radius: 16px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #f0f0f3 0%, #e8ecf0 100%);
      color: var(--text);
      height: 100%;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .site-header {
      backdrop-filter: blur(10px);
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      box-shadow: var(--shadow);
      text-align: center;
      position: sticky;
      top: 10px;
      z-index: 10;
    }

    .scene {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 24px;
      width: 100%;
    }

    .control-panel-ui {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      width: 280px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 15;
    }

    .info-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      width: 280px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 15;
    }

    .control-panel-ui h3,
    .info-panel h3 {
      font-size: 16px;
      color: var(--text);
      border-bottom: 1px solid var(--border);
      padding-bottom: 6px;
    }

    .control-panel-ui label {
      font-size: 14px;
      color: var(--subtext);
    }

    .control-panel-ui input,
    .control-panel-ui select {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 14px;
      background: white;
      color: var(--text);
      transition: all 0.2s ease;
    }

    .control-panel-ui input:focus,
    .control-panel-ui select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 6px rgba(0, 122, 255, 0.3);
    }

    .control-panel-ui button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .control-panel-ui button:hover {
      background: #005fce;
    }

    .status-group {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: var(--subtext);
    }

    .status-value {
      font-weight: 600;
      color: var(--text);
    }

    .notification-area {
      background: rgba(255, 255, 255, 0.7);
      color: #333;
      padding: 10px;
      border-left: 4px solid var(--accent);
      border-radius: 8px;
      font-size: 14px;
      backdrop-filter: blur(6px);
      transition: all 0.3s;
    }

    .warning-notice {
      border-left-color: #ffcc00;
      color: #b58900;
    }

    .critical-notice {
      border-left-color: #ff3b30;
      color: #b00020;
    }

    .bus-station {
      position: relative;
      width: 900px;
      height: 500px;
      background: var(--panel-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid var(--border);
      z-index: 1;
    }

    .bus-lane {
      position: absolute;
      top: 50%;
      left: 0;
      height: 200px;
      width: 100%;
      background: linear-gradient(
        180deg,
        #4a5568 0%,
        #2d3748 25%,
        #1a202c 50%,
        #2d3748 75%,
        #4a5568 100%
      );
      transform: translateY(-50%);
      box-shadow: 
        inset 0 8px 16px rgba(0, 0, 0, 0.4),
        inset 0 -8px 16px rgba(0, 0, 0, 0.4),
        0 4px 8px rgba(0, 0, 0, 0.2);
      border-top: 4px solid #fbbf24;
      border-bottom: 4px solid #fbbf24;
      z-index: 2;
      overflow: hidden;
    }

    .bus-lane::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        repeating-linear-gradient(
          45deg,
          transparent,
          transparent 2px,
          rgba(255, 255, 255, 0.03) 2px,
          rgba(255, 255, 255, 0.03) 4px
        );
      z-index: 1;
    }

    .bus-lane::after {
      content: 'üöå ÂÖ¨ËªäÂ∞àÁî®ÈÅì';
      position: absolute;
      bottom: 15px;
      left: 25px;
      color: #fbbf24;
      font-size: 16px;
      font-weight: 700;
      text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.8),
        0 0 8px rgba(251, 191, 36, 0.5);
      z-index: 3;
      letter-spacing: 2px;
    }

    .bus-lane.active::before {
      animation: roadShimmer 3s linear infinite;
      background-image: 
        linear-gradient(
          90deg,
          transparent 40%,
          rgba(255, 255, 255, 0.1) 50%,
          transparent 60%
        ),
        repeating-linear-gradient(
          45deg,
          transparent,
          transparent 2px,
          rgba(255, 255, 255, 0.03) 2px,
          rgba(255, 255, 255, 0.03) 4px
        );
      background-size: 200% 100%, 100% 100%;
    }

    @keyframes roadShimmer {
      0% { background-position: -100% 0; }
      100% { background-position: 100% 0; }
    }

    .bus-stop {
      position: absolute;
      top: 353px;
      left: 0;
      height: 80px;
      width: 900px;
      background: var(--background);
      border-radius: 8px;
      box-shadow: var(--shadow);
      z-index: 3;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--text);
      font-weight: bold;
      font-size: 16px;
    }

    .waiting-queue {
      position: absolute;
      top: 360px;
      left: 610px;
      width: 300px;
      display: grid;
      grid-template-columns: repeat(12, 25px);
      gap: 0;
      justify-content: start;
      align-content: start;
      z-index: 4;
    }

    .waiting-passenger {
      width: 20px;
      height: 20px;
      background: linear-gradient(145deg, #718096, #4a5568);
      border-radius: 50% 50% 40% 40%;
      position: relative;
      transition: all 0.5s ease;
      z-index: 5;
      margin: auto;
      box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.2),
        inset 0 1px 2px rgba(255, 255, 255, 0.6);
      transform: rotate(0deg);
    }

    .waiting-passenger::before {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 8px;
      height: 8px;
      background: radial-gradient(
        circle at 30% 30%,
        rgba(255, 255, 255, 0.8) 0%,
        rgba(255, 255, 255, 0.3) 60%,
        transparent 100%
      );
      border-radius: 50%;
    }

    .waiting-passenger.crowded {
      background: linear-gradient(145deg, #f56565, #e53e3e);
      animation: crowdedShake 0.4s infinite alternate;
    }

    .bus {
      display: flex;
      flex-direction: column;
      width: 400px;
      height: 210px;
      border: 3px solid var(--text);
      background: var(--panel-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      position: absolute;
      top: 50%;
      left: -420px;
      transform: translateY(-50%);
      transition: left 4s ease-in-out;
      z-index: 6;
      overflow: hidden;
    }

    .bus.arrived {
      left: 80px;
    }

    .bus.departed {
      left: 1000px;
    }

    .bus-front {
      position: absolute;
      left: -40px;
      top: 0;
      width: 50px;
      height: 210px;
      background: var(--panel-bg);
      border-radius: 12px 0 0 12px;
      border: 3px solid var(--text);
      border-right: none;
      z-index: 7;
    }

    .bus-windshield {
      position: absolute;
      left: -30px;
      top: 40px;
      width: 40px;
      height: 60px;
      background: var(--background);
      border-radius: 6px;
      border: 2px solid var(--text);
      z-index: 8;
    }

    .bus-number {
      position: absolute;
      left: 20px;
      top: 20px;
      padding: 5px 10px;
      background: white;
      border-radius: 6px;
      font-weight: bold;
      color: var(--text);
      font-size: 14px;
      box-shadow: var(--shadow);
      z-index: 9;
    }

    .bus-interior {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 380px;
      height: 190px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      z-index: 10;
    }

    .row {
      display: flex;
      flex: 1;
      height: 38px;
    }

    .seat {
      width: 36px;
      height: 36px;
      margin: 3px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 13px;
      font-weight: 600;
      border-radius: 8px;
      position: relative;
      transition: all 0.3s ease;
      cursor: pointer;
      background: linear-gradient(145deg, #f0f4f8, #e2e8f0);
      border: 2px solid #cbd5e0;
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.1),
        inset 0 1px 2px rgba(255, 255, 255, 0.8);
      transform: rotate(-90deg); /* Â∫ßÊ§ÖÈù¢ÂêëÂ∑¶ÈÇäÔºàÂÖ¨ËªäÂâçÊñπÔºâ */
    }

    .seat::before {
      content: '';
      position: absolute;
      top: 2px;
      right: -2px; /* Èù†ËÉåÁßªÂà∞Âè≥ÂÅ¥ÔºåÈù¢ÂêëÂ∑¶ */
      width: 8px;
      height: 32px;
      background: linear-gradient(145deg, #e2e8f0, #cbd5e0);
      border-radius: 6px 0 0 6px;
      border: 1px solid #a0aec0;
      border-right: none;
    }

    .seat::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 4px;
      bottom: 4px;
      width: 1px;
      background: rgba(160, 174, 192, 0.4);
      transform: translateX(-50%);
    }

    .seat:hover {
      transform: rotate(-90deg) translateY(-1px);
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.15),
        inset 0 1px 3px rgba(255, 255, 255, 0.9);
      border-color: #4299e1;
    }

    .seat.occupied {
      background: var(--accent);
      border-color: #005fce;
      color: white;
    }

    .seat.occupied::before {
      background: linear-gradient(145deg, #005fce, #003087);
      border-color: #003087;
    }

    .seat.occupied::after {
      background: rgba(255, 255, 255, 0.3);
    }

    .seat.priority {
      background: linear-gradient(145deg, #f093fb, #f5576c);
      border-color: #e53e3e;
      color: white;
    }

    .seat.priority::before {
      background: linear-gradient(145deg, #f5576c, #e53e3e);
      border-color: #c53030;
    }

    .seat.priority::after {
      content: '‚ôø';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(90deg); /* ÊäµÊ∂àÁà∂ÂÖÉÁ¥†ÊóãËΩâ */
      font-size: 16px;
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      background: none;
      height: auto;
      width: auto;
    }

    .seat.elderly {
      background: linear-gradient(145deg, #fbd38d, #f6ad55);
      border-color: #ed8936;
      color: #744210;
    }

    .seat.elderly::before {
      background: linear-gradient(145deg, #f6ad55, #ed8936);
      border-color: #dd6b20;
    }

    .seat.elderly::after {
      content: '‚ù§';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(90deg); /* ÊäµÊ∂àÁà∂ÂÖÉÁ¥†ÊóãËΩâ */
      font-size: 14px;
      color: #744210;
      background: none;
      height: auto;
      width: auto;
    }

    .escape {
      width: 36px;
      height: 36px;
      margin: 3px;
      background: #ff9500;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 6px;
      box-shadow: var(--shadow);
    }

    .driver {
      width: 36px;
      height: 36px;
      margin: 3px;
      background: #ff3b30;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 6px;
      box-shadow: var(--shadow);
    }

    .aisle {
      width: 36px;
      height: 36px;
      margin: 3px;
      background: var(--panel-bg);
      color: var(--subtext);
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 6px;
    }

    .door {
      width: 36px;
      height: 36px;
      margin: 3px;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 6px;
      box-shadow: var(--shadow);
    }

    .front-door {
      background: #2ecc71;
    }

    .front-door::after {
      content: 'ÂâçÈñÄ';
      font-size: 12px;
      font-weight: 600;
    }

    .back-door {
      background: var(--accent);
    }

    .back-door::after {
      content: 'ÂæåÈñÄ';
      font-size: 12px;
      font-weight: 600;
    }

    .door.active {
      animation: doorPulse 0.5s ease-in-out;
    }

    @keyframes doorPulse {
      0% { transform: scale(1); box-shadow: 0 0 8px rgba(255, 255, 255, 0.5); }
      50% { transform: scale(1.1); box-shadow: 0 0 16px rgba(255, 255, 255, 0.8); }
      100% { transform: scale(1); box-shadow: 0 0 8px rgba(255, 255, 255, 0.5); }
    }

    .stand-zone {
      position: absolute;
      left: 179px;
      top: 48px;
      width: 210px;
      height: 114px;
      background: #ecf0f1;
      border: 2px dashed var(--subtext);
      border-radius: 6px;
      display: flex;
      flex-wrap: wrap;
      align-content: flex-start;
      overflow: visible;
      z-index: 13;
    }

    .stand-zone.overcrowded {
      animation: crowdedShake 0.5s infinite alternate;
    }

    .passenger {
      width: 20px;
      height: 20px;
      background: linear-gradient(145deg, var(--accent), #005fce);
      border-radius: 50% 50% 40% 40%;
      position: absolute;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 14;
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.2),
        inset 0 1px 2px rgba(255, 255, 255, 0.8);
      transform: rotate(0deg);
    }

    .passenger::before {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 8px;
      height: 8px;
      background: radial-gradient(
        circle at 30% 30%,
        rgba(255, 255, 255, 0.6) 0%,
        rgba(255, 255, 255, 0.2) 40%,
        transparent 70%
      );
      border-radius: 50%;
    }

    .passenger.seated {
      width: 18px;
      height: 18px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(90deg); /* ‰πòÂÆ¢Èù¢ÂêëÂâçÊñπ */
      background: var(--accent);
    }

    .passenger.crowded {
      background: linear-gradient(145deg, #ee8f8f, #e86969);
      animation: crowdedShake 0.4s infinite alternate;
    }

    .passenger.overcrowded {
      width: 14px;
      height: 14px;
      background: linear-gradient(145deg, #f54b4b, #ff5151);
      animation: overcrowdedPulse 0.6s infinite alternate;
    }

    .passenger.overcrowded::before {
      width: 6px;
      height: 6px;
      top: 2px;
      left: 2px;
    }

    @keyframes crowdedShake {
      0% { transform: translate(0, 0) scale(1); }
      25% { transform: translate(1px, -1px) scale(1.05); }
      50% { transform: translate(-1px, 1px) scale(1); }
      75% { transform: translate(1px, 1px) scale(1.05); }
      100% { transform: translate(0, 0) scale(1); }
    }

    @keyframes overcrowdedPulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 8px rgba(197, 48, 48, 0.5);
      }
      100% {
        transform: scale(1.1);
        box-shadow: 0 0 16px rgba(197, 48, 48, 0.8);
      }
    }

    .capacity-indicator {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #2ecc71;
      box-shadow: 0 0 8px #2ecc71;
      transition: background 0.3s, box-shadow 0.3s;
      position: absolute;
      top: 330px;
      left: 610px;
      z-index: 16;
    }

    .capacity-indicator.warning {
      background: #ffcc00;
      box-shadow: 0 0 8px #ffcc00;
    }

    .capacity-indicator.full {
      background: #ff3b30;
      box-shadow: 0 0 8px #ff3b30;
    }

    .boarding-chaos {
      position: absolute;
      width: 100%;
      height: 100%;
      background: rgba(255, 59, 48, 0);
      z-index: 30;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 24px;
      font-weight: 600;
      opacity: 0;
      transition: all 0.6s;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    .boarding-chaos.active {
      background: rgba(255, 59, 48, 0.4);
      opacity: 1;
    }

    .flying-passenger {
      position: absolute;
      width: 20px;
      height: 20px;
      background: linear-gradient(145deg, #718096, #4a5568);
      border-radius: 50% 50% 40% 40%;
      z-index: 20;
      transition: all 0.8s cubic-bezier(0.25, 0.1, 0.25, 1);
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.3),
        0 0 8px rgba(113, 128, 150, 0.5);
      transform: rotate(0deg);
    }

    .flying-passenger::before {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 8px;
      height: 8px;
      background: radial-gradient(
        circle at 30% 30%,
        rgba(255, 255, 255, 0.6) 0%,
        rgba(255, 255, 255, 0.2) 40%,
        transparent 70%
      );
      border-radius: 50%;
    }

    .flying-passenger.crowded {
      background: linear-gradient(145deg, #f56565, #e53e3e);
    }

    .capacity-info-btn {
      position: absolute;
      bottom: 15px;
      right: 15px;
      padding: 8px 12px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: var(--shadow);
      z-index: 17;
      transition: all 0.3s ease;
    }

    .capacity-info-btn:hover {
      background: #005fce;
    }

    .capacity-info {
      position: absolute;
      bottom: 55px;
      right: 15px;
      width: 260px;
      background: var(--panel-bg);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      font-size: 15px;
      color: var(--text);
      display: none;
      z-index: 18;
      border: 1px solid var(--border);
      backdrop-filter: blur(12px);
    }

    .capacity-info.show {
      display: block;
    }

    .capacity-info h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text);
      border-bottom: 1px solid var(--border);
      padding-bottom: 6px;
    }

    .capacity-info ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .capacity-info li {
      display: flex;
      align-items: center;
      font-size: 15px;
      margin-bottom: 10px;
      color: var(--text);
    }

    .capacity-info .indicator-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
      display: inline-block;
    }

    .capacity-info .status-normal .indicator-dot {
      background: #2ecc71;
    }

    .capacity-info .status-warning .indicator-dot {
      background: #ffcc00;
    }

    .capacity-info .status-full .indicator-dot {
      background: #ff3b30;
    }

    .capacity-info .status-capacity .indicator-dot {
      background: var(--accent);
    }

    .audio-controls {
      display: none;
    }

    @media (max-width: 1100px) {
      .bus-station {
        transform: scale(0.85);
        transform-origin: center top;
      }
      .control-panel-ui, .info-panel {
        width: 260px;
      }
    }

    @media (max-width: 900px) {
      .bus-station {
        transform: scale(0.7);
      }
      .control-panel-ui {
        left: 10px;
        top: 80px;
      }
      .info-panel {
        right: 10px;
        top: 80px;
      }
    }

    @media (max-width: 600px) {
      .bus-station {
        transform: scale(0.5);
        margin-top: -60px;
      }
      .site-header {
        font-size: 18px;
      }
      .container {
        padding: 16px;
      }
      .control-panel-ui, .info-panel {
        width: 90%;
        max-width: 240px;
      }
      .control-panel-ui {
        left: 5px;
        top: 60px;
      }
      .info-panel {
        right: 5px;
        top: 60px;
      }
      .capacity-info {
        width: 220px;
        font-size: 14px;
      }
      .capacity-info li {
        font-size: 14px;
        margin-bottom: 8px;
      }
      .capacity-info h4 {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="site-header">
      <h1>Âè∞ÂåóÂÖ¨ËªäÊìÅÊì†Â∫¶‰∫íÂãïÊ®°Êì¨Á≥ªÁµ±</h1>
    </header>

    <div class="scene">
      <div class="control-panel-ui">
        <h3>Ê®°Êì¨Ë®≠ÂÆö</h3>
        <div>
          <label for="waiting-passengers">ÂÄôËªä‰∫∫Êï∏</label>
          <input type="number" id="waiting-passengers" value="80" min="1">
        </div>
        <div>
          <label for="boarding-style">‰∏äËªäÊ®°Âºè</label>
          <select id="boarding-style">
            <option value="normal">ÊúâÂ∫è‰∏äËªä</option>
            <option value="rush" selected>ÊìÅÊì†Êê∂‰∏ä</option>
            <option value="extreme">Ê•µÂ∫¶ÊìÅÊì†</option>
          </select>
        </div>
        <button id="simulate-btn">ÈñãÂßãÊ®°Êì¨‰∏äËªä</button>
      </div>

      <div class="bus-station">
        <div class="bus-lane"></div>
        <div class="bus-stop">ÂÖ¨ËªäÁ´ô</div>
        <div class="capacity-indicator"></div>
        <div class="waiting-queue"></div>
        <div class="bus">
          <div class="bus-front"></div>
          <div class="bus-windshield"></div>
          <div class="bus-number"></div>
          <div class="bus-interior">
            <div class="row row-1">
              <div class="seat" data-seat-id="1"></div>
              <div class="seat" data-seat-id="2"></div>
              <div class="seat" data-seat-id="3"></div>
              <div class="seat priority" data-seat-id="4"></div>
              <div class="escape"></div>
              <div class="seat priority" data-seat-id="5"></div>
              <div class="seat priority" data-seat-id="6"></div>
              <div class="seat priority" data-seat-id="7"></div>
              <div class="driver"></div>
            </div>
            <div class="row row-2">
              <div class="seat" data-seat-id="8"></div>
              <div class="seat" data-seat-id="9"></div>
              <div class="seat" data-seat-id="10"></div>
              <div class="seat priority" data-seat-id="11"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
            </div>
            <div class="row row-3">
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
            </div>
            <div class="row row-4">
              <div class="seat" data-seat-id="12"></div>
              <div class="seat" data-seat-id="13"></div>
              <div class="seat" data-seat-id="14"></div>
              <div class="seat priority" data-seat-id="15"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
              <div class="aisle"></div>
            </div>
            <div class="row row-5">
              <div class="seat" data-seat-id="16"></div>
              <div class="seat" data-seat-id="17"></div>
              <div class="seat" data-seat-id="18"></div>
              <div class="seat priority" data-seat-id="19"></div>
              <div class="door front-door"></div>
              <div class="seat priority" data-seat-id="20"></div>
              <div class="seat priority" data-seat-id="21"></div>
              <div class="seat priority" data-seat-id="22"></div>
              <div class="door back-door"></div>
            </div>
          </div>
          <div class="stand-zone"></div>
        </div>
        <div class="boarding-chaos">ÊìÅÊì†Ë≠¶ÂëäÔºÅ</div>
        <button class="capacity-info-btn">ÂÆ¢ÊªøÂÆöÁæ©Ë™™Êòé</button>
        <div class="capacity-info">
          <h4>ÂÖ¨ËªäÂÆπÈáèË≠¶Á§∫</h4>
          <ul>
            <li class="status-normal"><span class="indicator-dot"></span>Ê≠£Â∏∏ÔºöËªäÂÖßÁ©∫ÈñìÂÖÖË∂≥</li>
            <li class="status-warning"><span class="indicator-dot"></span>Êé•ËøëÂÆ¢ÊªøÔºöÁ´ôÁ´ãÂçÄË∂ÖÈÅé 70%</li>
            <li class="status-full"><span class="indicator-dot"></span>ÂÆåÂÖ®ÂÆ¢ÊªøÔºöÁ´ôÁ´ãÁ©∫ÈñìÂ∑≤Êªø</li>
            <li class="status-capacity"><span class="indicator-dot"></span>È°çÂÆöËºâÂÆ¢Ôºö22 Â∫ß‰Ωç + 30 Á´ôÁ´ã</li>
          </ul>
        </div>
      </div>

      <div class="info-panel">
        <h3>ÂÆπÈáèÁµ±Ë®à</h3>
        <div class="status-group">
          <span class="status-label">Á∏ΩÂÄôËªä‰∫∫Êï∏Ôºö</span>
          <span class="status-value" id="total-waiting">0</span>
        </div>
        <div class="status-group">
          <span class="status-label">Â∑≤‰∏äËªä‰∫∫Êï∏Ôºö</span>
          <span class="status-value" id="boarded">0</span>
        </div>
        <div class="status-group">
          <span class="status-label">Â∫ß‰Ωç‰πòÂÆ¢Êï∏Ôºö</span>
          <span class="status-value" id="seated-count">0</span>
        </div>
        <div class="status-group">
          <span class="status-label">Á´ôÁ´ãÂçÄ‰∫∫Êï∏Ôºö</span>
          <span class="status-value" id="standing-count">0</span>
        </div>
        <div class="status-group">
          <span class="status-label">Ââ©È§òÁ´ôÁ´ãÁ©∫ÈñìÔºö</span>
          <span class="status-value" id="remaining-capacity">30</span>
        </div>
        <div class="status-group">
          <span class="status-label">ÁõÆÂâçÁãÄÊÖãÔºö</span>
          <span class="status-value" id="current-status">Ê≠£Â∏∏</span>
        </div>
        <div id="notification-area" class="notification-area">
          Ë´ã‰æùÂ∫è‰∏äËªäÔºåËªäËºõÊúâË∂≥Â§†Á©∫Èñì
        </div>
      </div>
    </div>

    <div class="audio-controls">
      <audio id="boarding-audio" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>
      <audio id="crowded-audio" src="https://www.soundjay.com/buttons/beep-02.mp3"></audio>
      <audio id="full-audio" src="https://www.soundjay.com/buttons/beep-03.mp3"></audio>
    </div>
  </div>

  <script>
    "use strict";

    document.addEventListener('DOMContentLoaded', function() {
      // Constants
      const MAX_STANDING_CAPACITY = 40;
      const DEFAULT_STANDING_CAPACITY = 30;
      const SEATED_CAPACITY = 22;

      // State
      let currentlyBoarded = 0;
      let currentSeated = 0;
      let currentStanding = 0;
      let isSimulationRunning = false;
      let boardingInterval;
      let seatStatus = Array(SEATED_CAPACITY).fill(false);

      // DOM Elements
      const waitingPassengersInput = document.getElementById('waiting-passengers');
      const boardingStyleSelect = document.getElementById('boarding-style');
      const simulateBtn = document.getElementById('simulate-btn');
      const waitingQueue = document.querySelector('.waiting-queue');
      const bus = document.querySelector('.bus');
      const busLane = document.querySelector('.bus-lane');
      const standZone = document.querySelector('.stand-zone');
      const capacityIndicator = document.querySelector('.capacity-indicator');
      const boardingChaos = document.querySelector('.boarding-chaos');
      const notificationArea = document.getElementById('notification-area');
      const capacityInfoBtn = document.querySelector('.capacity-info-btn');
      const capacityInfo = document.querySelector('.capacity-info');
      const seatSpots = document.querySelectorAll('.seat');
      const frontDoor = document.querySelector('.front-door');
      const backDoor = document.querySelector('.back-door');

      // Audio
      const boardingAudio = document.getElementById('boarding-audio');
      const crowdedAudio = document.getElementById('crowded-audio');
      const fullAudio = document.getElementById('full-audio');

      // Displays
      const totalWaitingDisplay = document.getElementById('total-waiting');
      const boardedDisplay = document.getElementById('boarded');
      const seatedCountDisplay = document.getElementById('seated-count');
      const standingCountDisplay = document.getElementById('standing-count');
      const remainingCapacityDisplay = document.getElementById('remaining-capacity');
      const currentStatusDisplay = document.getElementById('current-status');

      // Error checking
      if (!waitingPassengersInput || !boardingStyleSelect || !simulateBtn || !frontDoor || !backDoor) {
        console.error('Critical DOM elements not found. Check IDs and classes.');
        return;
      }

      // Get door position relative to .bus-station
      function getDoorPosition(isFrontDoor) {
        const doorElement = isFrontDoor ? frontDoor : backDoor;
        const busStation = document.querySelector('.bus-station');
        const doorRect = doorElement.getBoundingClientRect();
        const stationRect = busStation.getBoundingClientRect();

        // Get scale factor from .bus-station's transform
        let scale = 1;
        const computedStyle = window.getComputedStyle(busStation);
        const transform = computedStyle.transform;
        if (transform && transform !== 'none') {
          const matrix = transform.match(/matrix\(([^)]+)\)/);
          if (matrix) {
            const values = matrix[1].split(',').map(parseFloat);
            scale = values[0]; // Assuming uniform scaling
          }
        }

        // Calculate door center relative to .bus-station
        const doorX = (doorRect.left + doorRect.width / 2 - stationRect.left) / scale;
        const doorY = (doorRect.top + doorRect.height / 2 - stationRect.top) / scale;

        return { x: doorX, y: doorY };
      }

      // Initialize waiting area
      function initWaitingArea(count) {
        waitingQueue.innerHTML = '';
        if (count > 500) {
          alert('ÂÄôËªä‰∫∫Êï∏ÈÅéÂ§öÔºà>500ÔºâÔºåÂ∑≤Ë®≠ÁÇ∫500„ÄÇ');
          count = 500;
        }
        const rows = Math.ceil(count / 12);
        waitingQueue.style.gridTemplateRows = `repeat(${rows}, 25px)`;
        waitingQueue.style.height = `${rows * 25}px`;

        for (let i = 0; i < count; i++) {
          const passenger = document.createElement('div');
          passenger.className = 'waiting-passenger';
          passenger.dataset.passId = i;
          if (count > 40) passenger.classList.add('crowded');
          waitingQueue.appendChild(passenger);
        }
        totalWaitingDisplay.textContent = count;
        updateStatsDisplay();
      }

      // Update statistics display
      function updateStatsDisplay() {
        boardedDisplay.textContent = currentlyBoarded;
        seatedCountDisplay.textContent = currentSeated;
        standingCountDisplay.textContent = currentStanding;
        remainingCapacityDisplay.textContent = Math.max(0, DEFAULT_STANDING_CAPACITY - currentStanding);

        if (currentStanding < DEFAULT_STANDING_CAPACITY * 0.7) {
          currentStatusDisplay.textContent = 'Ê≠£Â∏∏';
          capacityIndicator.className = 'capacity-indicator';
          notificationArea.className = 'notification-area';
          notificationArea.textContent = 'Ë´ã‰æùÂ∫è‰∏äËªäÔºåËªäËºõÊúâË∂≥Â§†Á©∫Èñì';
        } else if (currentStanding < DEFAULT_STANDING_CAPACITY) {
          currentStatusDisplay.textContent = 'Êé•ËøëÂÆ¢Êªø';
          capacityIndicator.className = 'capacity-indicator warning';
          notificationArea.className = 'notification-area warning-notice';
          notificationArea.textContent = 'ËªäÂªÇÊé•ËøëÂÆ¢ÊªøÔºåË´ãÂæÄËªäÂªÇÂÖßÈÉ®ÁßªÂãï';
        } else {
          currentStatusDisplay.textContent = 'ÂÆåÂÖ®ÂÆ¢Êªø';
          capacityIndicator.className = 'capacity-indicator full';
          notificationArea.className = 'notification-area critical-notice';
          notificationArea.textContent = 'ËªäËºõÂ∑≤ÂÆ¢ÊªøÔºåË´ãÁ≠âÂÄô‰∏ã‰∏ÄÁè≠Ëªä';
        }
      }

      // Find empty seat
      function findEmptySeat() {
        for (let i = 0; i < seatStatus.length; i++) {
          if (!seatStatus[i]) {
            seatStatus[i] = true;
            return i + 1;
          }
        }
        return null;
      }

      // Create flying passenger
      function createFlyingPassenger(startX, startY, boardedCount, delay) {
        const passenger = document.createElement('div');
        passenger.className = 'flying-passenger';
        if (boardedCount > 40) passenger.classList.add('crowded');
        passenger.style.top = `${startY}px`;
        passenger.style.left = `${startX}px`;
        document.querySelector('.bus-station').appendChild(passenger);

        // Determine door
        const isFrontDoor = boardedCount % 2 === 0;
        const doorElement = isFrontDoor ? frontDoor : backDoor;
        const doorPos = getDoorPosition(isFrontDoor);

        // Center passenger at door
        const passengerOffsetX = -10; // Half passenger width
        const passengerOffsetY = -10; // Half passenger height
        const doorX = doorPos.x + passengerOffsetX;
        const doorY = doorPos.y + passengerOffsetY;

        // Position just outside door
        const exteriorDoorY = doorY + 20;

        setTimeout(() => {
          // Move to outside door
          passenger.style.transition = 'all 0.4s ease-in-out';
          passenger.style.top = `${exteriorDoorY}px`;
          passenger.style.left = `${doorX}px`;

          // Flash door
          doorElement.classList.add('active');
          setTimeout(() => doorElement.classList.remove('active'), 500);

          setTimeout(() => {
            // Move inside door
            passenger.style.transition = 'all 0.4s ease-in-out';
            passenger.style.top = `${doorY}px`;
            passenger.style.left = `${doorX}px`;

            setTimeout(() => {
              passenger.remove();
              if (currentSeated < SEATED_CAPACITY) {
                const seatId = findEmptySeat();
                if (seatId) {
                  const seatElement = document.querySelector(`.seat[data-seat-id="${seatId}"]`);
                  if (seatElement) {
                    const passenger = document.createElement('div');
                    passenger.className = 'passenger seated';
                    seatElement.appendChild(passenger);
                    seatElement.classList.add('occupied');
                    currentlyBoarded++;
                    currentSeated++;
                    updateStatsDisplay();
                  }
                }
              } else {
                const passenger = document.createElement('div');
                passenger.className = 'passenger';
                if (currentStanding >= DEFAULT_STANDING_CAPACITY) {
                  passenger.classList.add('crowded', 'overcrowded');
                  standZone.classList.add('overcrowded');
                }
                passenger.style.position = 'absolute';
                const maxX = currentStanding >= DEFAULT_STANDING_CAPACITY ? 198 : 192;
                const maxY = currentStanding >= DEFAULT_STANDING_CAPACITY ? 102 : 96;
                passenger.style.left = `${Math.random() * maxX}px`;
                passenger.style.top = `${Math.random() * maxY}px`;
                standZone.appendChild(passenger);
                currentlyBoarded++;
                currentStanding++;
                updateStatsDisplay();
              }
            }, 400);
          }, 400);
        }, delay);
      }

      // Simulate boarding
      function simulateBoarding() {
        if (isSimulationRunning) return;
        isSimulationRunning = true;
        simulateBtn.disabled = true;

        resetBusInterior();

        bus.classList.add('arrived');
        bus.classList.remove('departed');
        busLane.classList.add('active');

        let waitingCount = parseInt(waitingPassengersInput.value) || 25;
        if (waitingCount > 500) {
          alert('ÂÄôËªä‰∫∫Êï∏ÈÅéÂ§öÔºà>500ÔºâÔºåÂ∑≤Ë®≠ÁÇ∫500„ÄÇ');
          waitingCount = 500;
        }
        const boardingStyle = boardingStyleSelect.value;

        initWaitingArea(waitingCount);

        let boardingSpeed, chaosLevel, batchSize;
        switch (boardingStyle) {
          case 'normal':
            boardingSpeed = 800;
            chaosLevel = 0;
            batchSize = 1;
            break;
          case 'rush':
            boardingSpeed = 400;
            chaosLevel = 1;
            batchSize = 3;
            break;
          case 'extreme':
            boardingSpeed = 250;
            chaosLevel = 2;
            batchSize = 5;
            break;
          default:
            boardingSpeed = 400;
            chaosLevel = 1;
            batchSize = 3;
        }

        let boardedCount = 0;

        setTimeout(() => {
          boardingAudio.play().catch(() => console.warn('Audio failed to play: boarding-audio'));

          if (chaosLevel === 2) {
            boardingChaos.classList.add('active');
            setTimeout(() => boardingChaos.classList.remove('active'), 1500);
          }

          boardingInterval = setInterval(() => {
            if (boardedCount >= waitingCount || currentlyBoarded >= SEATED_CAPACITY + MAX_STANDING_CAPACITY) {
              clearInterval(boardingInterval);
              if (currentlyBoarded >= SEATED_CAPACITY + MAX_STANDING_CAPACITY) {
                const remainingPassengers = waitingCount - currentlyBoarded;
                notificationArea.className = 'notification-area critical-notice';
                notificationArea.textContent = `ËªäËºõÂ∑≤ÈÅîÊúÄÂ§ßËºâÈáè${SEATED_CAPACITY + MAX_STANDING_CAPACITY}‰∫∫ÔºåÂâ©È§ò${remainingPassengers}‰∫∫Ë´ãÁ≠â‰∏ã‰∏ÄÁè≠`;
              }
              finishSimulation();
              return;
            }

            const batchCount = Math.min(batchSize, waitingCount - boardedCount);

            for (let i = 0; i < batchCount; i++) {
              if (boardedCount >= waitingCount) break;

              const passenger = waitingQueue.querySelector(`.waiting-passenger[data-pass-id="${boardedCount}"]`);
              if (!passenger) continue;

              const passengerRect = passenger.getBoundingClientRect();
              const stationRect = document.querySelector('.bus-station').getBoundingClientRect();
              const startX = passenger.getBoundingClientRect().left - stationRect.left;
              const startY = passenger.getBoundingClientRect().top - stationRect.top;

              const individualDelay = chaosLevel === 0 ? 0 : Math.random() * 200;
              createFlyingPassenger(startX, startY, boardedCount, individualDelay);

              passenger.style.opacity = '0';
              setTimeout(() => passenger.remove(), 400);

              boardedCount++;
            }

            if (currentStanding > DEFAULT_STANDING_CAPACITY * 0.7 && currentStanding <= DEFAULT_STANDING_CAPACITY) {
              crowdedAudio.play().catch(() => console.warn('Audio failed to play: crowded-audio'));
            } else if (currentStanding > DEFAULT_STANDING_CAPACITY) {
              fullAudio.play().catch(() => console.warn('Audio failed to play: full-audio'));
            }
          }, boardingSpeed);
        }, 4000);
      }

      // Reset bus interior
      function resetBusInterior() {
        standZone.innerHTML = '';
        standZone.classList.remove('overcrowded');
        seatStatus.fill(false);
        seatSpots.forEach(seat => {
          seat.innerHTML = '';
          seat.classList.remove('occupied');
        });
        currentlyBoarded = 0;
        currentSeated = 0;
        currentStanding = 0;
        updateStatsDisplay();
      }

      // Finish simulation
      function finishSimulation() {
        isSimulationRunning = false;

        if (currentStanding > DEFAULT_STANDING_CAPACITY) {
          standZone.classList.add('overcrowded');
          const passengers = standZone.querySelectorAll('.passenger:not(.seated)');
          passengers.forEach(p => {
            if (Math.random() > 0.4) {
              p.classList.add('crowded', 'overcrowded');
            }
          });
        }

        setTimeout(() => {
          bus.classList.remove('arrived');
          bus.classList.add('departed');
          busLane.classList.remove('active');
          setTimeout(() => {
            resetBusInterior();
            simulateBtn.disabled = false;
          }, 5000);
        }, 3000);
      }

      // Event listeners
      simulateBtn.addEventListener('click', () => {
        if (!isSimulationRunning) {
          simulateBtn.disabled = true;
          simulateBoarding();
        }
      });

      capacityInfoBtn.addEventListener('click', () => {
        capacityInfo.classList.toggle('show');
      });

      // Initialize
      initWaitingArea(25);
    });
  </script>
</body>
</html>